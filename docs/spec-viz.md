# Loom Visualization Specification

## Overview

This document is the top-level specification for Loom visualization.
It defines three visualization levels and the common output format.

Detailed conventions for each level are in separate documents:

- [spec-viz-adg.md](./spec-viz-adg.md): ADG (hardware) visualization
- [spec-viz-dfg.md](./spec-viz-dfg.md): DFG (software) visualization
- [spec-viz-gui.md](./spec-viz-gui.md): Browser-based viewer

## Visualization Levels

### Level 1: DFG-only

Visualizes the software dataflow graph extracted from `handshake.func`.
Shows operation nodes, data/control edges, sentinel nodes, and source
location annotations.

Use case: understanding DFG structure before mapping.

### Level 2: ADG-only

Visualizes the hardware architecture description graph from
`fabric.module`. Shows functional units, routing network, memory
modules, and connectivity.

Use case: inspecting hardware topology.

### Level 3: Mapped (DFG-on-ADG)

Visualizes the mapping result: which DFG operations are placed on which
ADG nodes, routing paths through the interconnect, and temporal
assignments.

Two display modes:

- **Overlay**: ADG as base graph, mapped nodes annotated with DFG info.
- **Side-by-side**: DFG and ADG shown in parallel with cross-highlighting.

Use case: debugging and validating mapper output.

## Output Format

All visualization outputs are **truly self-contained** single HTML files.
Each file embeds:

1. A DOT graph description (generated by the exporter).
2. The Graphviz WASM engine (viz.js) inlined as a base64-encoded script.
3. JavaScript for interactive features (zoom, pan, hover, click).
4. All CSS styles inline.

No server, CDN, network access, or external files are required to view
the output. The HTML file works fully offline in any modern browser.

Note: Inlining viz.js adds approximately 3 MB to each HTML file. This
is an acceptable trade-off for true portability.

## Common Conventions

### Color Encoding

- Mapped/active elements: operation-specific colors (see level specs).
- Unmapped/unused elements: white fill, dashed border.
- Routing paths: cycling color palette for distinct routes.
- Sentinel nodes: lightpink (input), lightcoral (output).

### Interaction Model

All levels support:

- **Zoom**: mouse wheel
- **Pan**: click + drag on background
- **Hover**: highlight node and connected edges
- **Click**: show detail panel with node attributes

Level 3 (Mapped) additionally supports:

- **Mode toggle**: switch between overlay and side-by-side
- **Cross-highlighting**: hover on one graph highlights corresponding
  nodes in the other (side-by-side mode only)
- **Source traceback**: click DFG node to see source file and line

## Related Documents

- [spec-viz-adg.md](./spec-viz-adg.md)
- [spec-viz-dfg.md](./spec-viz-dfg.md)
- [spec-viz-mapped.md](./spec-viz-mapped.md)
- [spec-viz-gui.md](./spec-viz-gui.md)
- [spec-mapper.md](./spec-mapper.md)
- [spec-adg.md](./spec-adg.md)
